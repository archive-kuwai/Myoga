<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>myoga by Naohiro OHTA</title>
	<meta name = "viewport" content = "width = device-width, initial-scale = 1, user-scalable = no">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="plugins/jquery.cookie.js"></script>
	<script src="http://crypto-js.googlecode.com/svn/tags/3.0.1/build/rollups/sha256.js"></script>
	<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<link rel="stylesheet" href="index.css">
	<script src="myAjaxEngineToMyoga.js"></script>
	<script>
		$(function(){
			// Initialize cookie
			$.cookie.json = true;
			
			// Make login selector
			NEW_USER = '(入力する)';
			var users = login_user_history_from_cookie();
			for(var i=0; i<users.length; i++){
				$('#user_selector').append("<option value='" +users[i]+ "'>" +users[i]+ "</option>");
			}
			
			// Hide URL bar
			hideURLBar();
		});
	</script>
	<script>
		function hideURLBar(){
			setTimeout(function(){window.scrollTo(0, 1);},200);
			setTimeout(function(){window.scrollTo(0, 1);},1000);
		}
		function jump(){
			var page = $('#page_select').val();
			ajaxToMyoga(
					{name:"getHTML", params:{"filename":page} },  
					function(result){$("#main_content").html(result.string); hideURLBar();}
			);
		}
		function login(){
			var user = $('#user_selector').val();
			if(user==NEW_USER){
				alert("New user sign up sqeuence.");
				setGlobalScopeVariable_WHO_AM_I(user,"default_password");
			}else{
				setGlobalScopeVariable_WHO_AM_I(user,"default_password");
				ajaxToMyoga({name:"getPerson",params:{a:5,b:6,c:7}}, function(result){console.log(result);});
			}
			make_page_selector();
		}
		
		function login_user_history_from_cookie(){
			console.log('#1');
			console.log($.cookie('login_user_history'));
			var login_user_history = $.cookie('login_user_history');
			console.log('#2');
			console.log(login_user_history);
			if(login_user_history == null){
				login_user_history = [NEW_USER];
				$.cookie('login_user_history',login_user_history);
			}
			return login_user_history;
		}
		
		function make_page_selector(){
			$("#page_select").empty;
			var pages = ["page1","page2","page3","page4_map"];
			var alias = pages;
			for(var i=0; i<pages.length; i++){
				$("#page_select").append("<option value='" +pages[i]+ "' id='" +pages[i]+ "'>" + alias[i] + "</a>");
			}
		}
	</script>
</head>
                                                     
<body>
	<header>
		<ul>
			<li style="display:inline;">
				<select id="user_selector" onChange="login()" style="background-color:black;">
						<option value='user0'>ユーザ選択</option>
				</select>
			</li>
			<li style="display:inline;background-color:black;">
				<nav style="display:inline;background-color:black;">
					<select id="page_select" onChange="jump()" style="background-color:black;">
						<option value='page0' id='page0'>ページ選択</option>
					</select>
				</nav>
			</li>
		</ul>
	</header>
	<section id='main_content'></section>
	<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
	<footer>&copy; 2012 Naohiro OHTA</footer>
</body>
</html>