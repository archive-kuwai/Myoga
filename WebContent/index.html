<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>myoga by Naohiro OHTA</title>
	<meta name = "viewport" content = "width = device-width, initial-scale = 1, user-scalable = no">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="plugins/jquery.cookie.js"></script>
	<script src="http://crypto-js.googlecode.com/svn/tags/3.0.1/build/rollups/sha256.js"></script>
	<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<link rel="stylesheet" href="index.css">
	<script src="myAjaxEngineToMyoga.js"></script>
	<script>
		$(function(){
			// Initialize cookie
			$.cookie.json = true;
			
			// Make user selector
			NEW_USER = '(入力する)';
			var users = logged_in_users();
			for(var i=0; i<users.length; i++){
				$('#user_selector').append("<option value='" +users[i]+ "'>" +users[i]+ "</option>");
			}
			
			// Hide URL bar
			hideURLBar();
		});
	</script>

	<script>
		function login(){
			var user = $('#user_selector').val();
			if(user==NEW_USER){
				login_with_new_user();
			}else{
				login_with_password(user);
			}
			make_page_selector();
		}
		
		function login_with_new_user(){
			var user = prompt('ユーザ','myoga');
			login_with_password(user);
			var users = $.cookie('logged_in_users');
			users.push(user);
			$.cookie('logged_in_users',users);
		}

		function login_with_password(user){
			var password = prompt('パスワード','myoga');
			setGlobalScopeVariable_WHO_AM_I(user, password);
			ajaxToMyoga({name:"getPerson",params:{a:5,b:6,c:7}}, function(result){console.log(result);});
						
		}
		
		
		function jump(){
			console.log("here!");
			var page = $('#page_selector').val();
			ajaxToMyoga(
					{name:"getHTML", params:{"filename":page} },  
					function(result){$("#main_content").html(result.string); hideURLBar();}
			);
		}

		function logged_in_users(){
			var users = $.cookie('logged_in_users');
			if(users == null){
				users = [NEW_USER];
				$.cookie('logged_in_users',users);
			}
			return users;
		}
		
		function make_page_selector(){
			$("#page_selector").empty();
			var pages = ["page1","page2","page3","page4_map"];
			var alias = pages;
			for(var i=0; i<pages.length; i++){
				$("#page_selector").append("<option value='" +pages[i]+ "' id='" +pages[i]+ "'>" + alias[i] + "</a>");
			}
		}

		function hideURLBar(){
			setTimeout(function(){window.scrollTo(0, 1);},200);
			setTimeout(function(){window.scrollTo(0, 1);},1000);
		}
	</script>
</head>
                                                     
<body>
	<header>
		<ul>
			<li style="display:inline;">
				<select id="user_selector" onChange="login()" style="background-color:black;">
						<option value='user0'>ユーザ</option>
				</select>
			</li>
			<li style="display:inline;background-color:black;">
				<nav style="display:inline;background-color:black;">
					<select id="page_selector" onChange="jump()" style="background-color:black;">
						<option value='page0' id='page0'>ページ</option>
					</select>
				</nav>
			</li>
		</ul>
	</header>
	<section id='main_content'></section>
	<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
	<footer>&copy; 2012 Naohiro OHTA</footer>
</body>
</html>